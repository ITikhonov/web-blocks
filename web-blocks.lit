


		Block coordinates

	Each block is rectangular area, which have top,
	left, bottom and right coordinates relative to
	page.

	So at the very core each block looks like:

=test-block-basic
-		page = { 
-			top:		20,
-			left:		20, 
-			bottom:		1010, 
-			right:		700, 
-		}

-		page.block1 = { 
-			top:		10,
-			left:		20, 
-			bottom:		20, 
-			right:		40, 
-		}


	But in real life block coordinates can't be defined
	directly, as they are function of content (text size)
	or environment (font, viewport size).

	So block coordinates are mostly specified in terms of
	relation to other blocks.


=test-block-relative
-		page = { 
-			top:		20,
-			left:		20, 
-			bottom:		1010, 
-			right:		700, 
-		}

-		page.block1 = {
-			top:	'page.top',
-			left:	'page.left + 20',
-			bottom:	'page.block1.top + 100',
-			right:	'page.block1.left + 120',
-		}

-		page.block2 = {
-			top:	'page.block1.bottom',
-			left:	'page.block1.right',
-			bottom:	'page.block2.top + 50',
-			right:	'page.block2.left + 75',
-		}

	Position of block2 depends on block1 position and size.


		Block content

	For some blocks their content is used to determine bottom
	and right coordinates.

	For each block content.bottom and content.right specifies
	maximum bottom and right coordinates of blocks it includes.

=test-block-content
-		block2 = {
-			top:	'block1.top + 10',
-			left:	'block1.left + 10',
-			bottom:	'block2.top + 50',
-			right:	'block2.left + 75',
-		}

-		block1 = {
-			top:	'page.top + 20',
-			left:	'page.left + 20',
-			bottom:	'block1.content.bottom + 20',
-			right:	'block1.content.right + 20',
-			content: [ block2 ]
-		}

		Wrap coordinates

	Retrieving left/right/top/bottom should try to evaluate it's value,
	so we define getters.

=wrap-block
-function wrap_coordinate(block,name) {
-	block['_'+name]=block[name];
-	block.__defineGetter__(name,function() { return eval_coord(this['_'+name]); });
-}

-function wrap_block(block) {
-	wrap_coordinate(block,'left');
-	wrap_coordinate(block,'top');
-	wrap_coordinate(block,'right');
-	wrap_coordinate(block,'bottom');
-	for(var k in block) {
-		if(k[0]!='_' && typeof block[k]=='object') {
-			wrap_block(block[k]);
-		}
-	}
-}


		Evaluating coordinates

	Converting relative coordinates into absolute

=eval-coord
-function eval_coord(expr) {
-	if(typeof expr == 'string') {
-		return eval(expr);
-	} else {
-		return expr;
-	}
-}

=eval-block
-function eval_block(block) {
-	for(var k in block) {
-		if(k[0]!='_' && typeof block[k]=='object') {
-			eval_block(block[k]);
-		}
-	}
-	block._el=document.createElement('div');
-	block._el.className='apos';
-	block._el.style.top	=block.top;
-	block._el.style.left	=block.left;
-	block._el.style.width	=block.right - block.left;
-	block._el.style.height	=block.bottom - block.top;
-}

		Producing html

=bake
-function bake(block) {
-	for(var k in block) {
-		if(k[0]!='_' && typeof block[k]=='object') {
-			document.body.appendChild(block[k]._el);
-			bake(block[k]);
-		}
-	}
-}
	
=>main.js
(function()
>eval-coord
>wrap-block
>eval-block
>bake

-window.onload=function() { wrap_block(page); eval_block(page); bake(page); };

)();

=test-html-pre
-<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><style>.apos{position:absolute;margin:0;padding:0;border:1px solid black;overflow:hidden}</style></head><script>

=test-html-post
-</script><script src="../main.js"></script><body></body></html>

=>test/basic.html
>test-html-pre
>test-block-basic
>test-html-post


=>test/relative.html
>test-html-pre
>test-block-relative
>test-html-post

=>test/content.html
>test-block-content
 
